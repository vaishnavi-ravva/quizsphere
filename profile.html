<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QuizSphere | My Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial, Helvetica, sans-serif;}

body{
  margin:0;
  min-height:100vh;
  padding-top:70px;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(to right,#141E30,#243B55);
}

/* NAVBAR */
.navbar{
  position:fixed;top:0;left:0;right:0;
  height:60px;
  background:rgba(0,0,0,0.8);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
  z-index:1000;
}
.logo{font-size:20px;font-weight:bold;color:#ff9800;}
.nav-links a{
  color:#fff;margin-left:20px;
  text-decoration:none;font-size:14px;
}
.nav-links a:hover{color:#ff9800;}

/* CARD */
.profile-card{
  background:#111;color:#fff;
  width:95%;max-width:420px;
  padding:30px;
  border-radius:14px;
  box-shadow:0 20px 40px rgba(0,0,0,0.6);
  text-align:center;
}

input{
  width:100%;
  padding:12px;
  margin-bottom:14px;
  border:none;
  border-radius:8px;
  background:#2e2e2e;
  color:#fff;
}
input:disabled{opacity:0.85;}

.btn{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  font-size:15px;
  font-weight:bold;
  cursor:pointer;
}

.edit{background:#1976d2;color:#fff;}
.save{background:#2e7d32;color:#fff;display:none;}
.tasks{background:#455a64;color:#fff;}
.certs{background:#6a1b9a;color:#fff;}
.back{background:#9e9e9e;color:#000;}

.box{
  display:none;
  margin-top:15px;
  background:#1c1c1c;
  padding:12px;
  border-radius:8px;
  font-size:13px;
  text-align:left;
  max-height:220px;
  overflow:auto;
}
</style>
</head>

<body>

<div class="navbar">
  <div class="logo">QuizSphere</div>
  <div class="nav-links">
    <a href="mode.html">Home</a>
    <a href="profile.html">Profile</a>
    <a href="#" onclick="logout()">Logout</a>
  </div>
</div>

<div class="profile-card">
  <h2>My Profile</h2>

  <input id="name" placeholder="Full Name" disabled>
  <input type="date" id="dob" disabled>
  <input id="bank" placeholder="Bank Account Number" disabled>
  <input id="ifsc" placeholder="IFSC Code" disabled>

  <button class="btn edit" id="editBtn" onclick="enableEdit()">Edit Profile</button>
  <button class="btn tasks" onclick="toggleHistory()">My Quiz History</button>
  <button class="btn certs" onclick="toggleCertificates()">My Certificates</button>
  <button class="btn save" id="saveBtn" onclick="saveProfile()">Save Changes</button>
  <button class="btn back" onclick="goBack()">Back</button>

  <div class="box" id="historyBox"></div>
  <div class="box" id="certBox"></div>
</div>

<script>
/* LOGIN GUARD */
if(!localStorage.getItem("qs_user")){
  location.href="login.html";
}

/* ELEMENTS */
const nameInput = document.getElementById("name");
const dobInput = document.getElementById("dob");
const bankInput = document.getElementById("bank");
const ifscInput = document.getElementById("ifsc");
const editBtn = document.getElementById("editBtn");
const saveBtn = document.getElementById("saveBtn");
const historyBox = document.getElementById("historyBox");
const certBox = document.getElementById("certBox");

/* LOAD PROFILE */
let profile = JSON.parse(localStorage.getItem("qs_profile") || "{}");
nameInput.value = profile.name || localStorage.getItem("qs_user") || "";
dobInput.value = profile.dob || "";
bankInput.value = profile.bank || "";
ifscInput.value = profile.ifsc || "";

/* üîÑ CERTIFICATE SYNC */
const singleCert = localStorage.getItem("qs_certificate");
let certArray = JSON.parse(localStorage.getItem("qs_certificates") || "[]");

if(singleCert){
  const certObj = JSON.parse(singleCert);
  const exists = certArray.some(
    c => c.domain === certObj.domain && c.score === certObj.score
  );
  if(!exists){
    certArray.push(certObj);
    localStorage.setItem("qs_certificates", JSON.stringify(certArray));
  }
}

/* EDIT */
function enableEdit(){
  [nameInput,dobInput,bankInput,ifscInput].forEach(i=>i.disabled=false);
  editBtn.style.display="none";
  saveBtn.style.display="block";
}

/* SAVE */
function saveProfile(){
  if(!nameInput.value || !dobInput.value){
    alert("Name and DOB required");
    return;
  }
  profile={
    name:nameInput.value.trim(),
    dob:dobInput.value,
    bank:bankInput.value.trim(),
    ifsc:ifscInput.value.trim()
  };
  localStorage.setItem("qs_profile",JSON.stringify(profile));
  localStorage.setItem("qs_user",profile.name);
  alert("Profile updated successfully");
  [nameInput,dobInput,bankInput,ifscInput].forEach(i=>i.disabled=true);
  saveBtn.style.display="none";
  editBtn.style.display="block";
}

/* QUIZ HISTORY */
function toggleHistory(){
  certBox.style.display="none";
  historyBox.style.display =
    historyBox.style.display==="block" ? "none" : "block";

  const history = JSON.parse(localStorage.getItem("qs_history") || "[]");
  if(history.length===0){
    historyBox.innerHTML="<p>No quiz attempts yet.</p>";
    return;
  }

  historyBox.innerHTML = history.map(h=>`
    <p>
      <b>${h.domain.toUpperCase()}</b> |
      ${h.mode} |
      Score: ${h.score}/10<br>
      <small>${h.date}</small>
    </p><hr>
  `).join("");
}

/* CERTIFICATES */
function toggleCertificates(){
  historyBox.style.display="none";
  certBox.style.display =
    certBox.style.display==="block" ? "none" : "block";

  const certs = JSON.parse(localStorage.getItem("qs_certificates") || "[]");
  if(certs.length===0){
    certBox.innerHTML="<p>No certificates earned yet.</p>";
    return;
  }

  certBox.innerHTML = certs.map(c=>`
    <p>
      üèÜ <b>${c.domain.toUpperCase()}</b><br>
      Score: ${c.score}<br>
      <small>${c.date}</small><br>
      <button onclick="location.href='certificate.html'">View Certificate</button>
    </p><hr>
  `).join("");
}

/* NAV */
function goBack(){location.href="mode.html";}
function logout(){
  localStorage.removeItem("qs_user");
  location.href="login.html";
}
</script>

</body>
</html>
